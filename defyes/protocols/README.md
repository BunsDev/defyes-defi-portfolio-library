# How to define a new protocol

You can define just a new python module, like `mynewprotocol.py` (try to use the Python module naming convention: lowercase and
without `_` if possible), but it's recommended to create a folder instead, like `mynewprotocol`, with the following
structure.

```
protocols/                    # current folder
  mynewprotocol/              # An arbitrary name for the protocol
    __init__.py               # at least empty to make mynewprotocol a python package
    abis/                     # ABIs folder
      my_abi_definition.json  # An arbitrary name for the ABI.
      ...                     # more ABI definitions
    autogen_config.json
```

> `mwnewprotocol` is just an example.

After running `make autogenerate` you'll get an `protocols/mynewprotocol/autogenerated.py` with a class definition for
every ABI, which methods are named using a snaked name version of the ABI methods. It define Python properties for
methods which don't define arguments, just for simplicity.

> Instead of using `make` you could also call `python defyes/autogenerate.py` inside the container.


## `autogen_config.json` schema
```json
{
  "my_abi_definition": {  /* The same name as the .json file you want to be included in autogeneration */
    "const_call": [  /* optional if you want to define some method results as invariant with respect to block_ids */
      "abiMethodNameAsItIs",
      /* ... more method names */
    ],
  /* ... more ABI definitions */
}
```

## `__init__.py`

Don't modify `autogenerated.py`. Instead import the defined classes inside `autogenerated.py` into `__init__.py`, like
this example

```python
from .autogenerated import Oracle, Treasury, VaultManager

# Optionally
class Oracle(Oracle):
    ...
```

Optionally you could override the contract class with the same name in this namespace, in order to add for example new high-level
methods or properties, or to override some original methods to change their behaviors. In this example, `Oracle` is a
new class in this module's namespace which inherits all the attributes from `.autogenerated.Oracle`. It won't change the
original `.autogenerated.Oracle` behaviors.
